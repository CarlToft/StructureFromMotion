function [F]=tritobi(T)

% function [F]=tritobi(T)
% Determines the bilinear form between images 1 and 2 from
% the trifocal tensor between images 1, 2 and 3
%
% Input:  T=trifocal tensor between images 1, 2 and 3
% Output: F=fundamental matrix between images 1 and 2

T1=T;

M1=[...
T1(1,1,1) T1(1,1,2) T1(1,1,3);...
T1(1,2,1) T1(1,2,2) T1(1,2,3);...
T1(1,3,1) T1(1,3,2) T1(1,3,3)];

M2=[...
T1(2,1,1) T1(2,1,2) T1(2,1,3);...
T1(2,2,1) T1(2,2,2) T1(2,2,3);...
T1(2,3,1) T1(2,3,2) T1(2,3,3)];

M3=[...
T1(3,1,1) T1(3,1,2) T1(3,1,3);...
T1(3,2,1) T1(3,2,2) T1(3,2,3);...
T1(3,3,1) T1(3,3,2) T1(3,3,3)];

[U,S,V]=svd(M1');
F1=V(:,3);
[U,S,V]=svd(M2');
F2=V(:,3);
[U,S,V]=svd(M3');
F3=V(:,3);

FF=[F1';F2';F3'];

T2=tritotri(T1);
M1=[...
T2(1,1,1) T2(1,1,2) T2(1,1,3);...
T2(1,2,1) T2(1,2,2) T2(1,2,3);...
T2(1,3,1) T2(1,3,2) T2(1,3,3)];

M2=[...
T2(2,1,1) T2(2,1,2) T2(2,1,3);...
T2(2,2,1) T2(2,2,2) T2(2,2,3);...
T2(2,3,1) T2(2,3,2) T2(2,3,3)];

M3=[...
T2(3,1,1) T2(3,1,2) T2(3,1,3);...
T2(3,2,1) T2(3,2,2) T2(3,2,3);...
T2(3,3,1) T2(3,3,2) T2(3,3,3)];

[U,S,V]=svd(M1');
FF1=V(:,3);
[U,S,V]=svd(M2');
FF2=V(:,3);
[U,S,V]=svd(M3');
FF3=V(:,3);

FFF=[FF1 FF2 FF3];

M=[...
FF(1,1) 0 0 FFF(1,1) 0 0;...
FF(1,2) 0 0 0 FFF(1,2) 0;...
FF(1,3) 0 0 0 0 FFF(1,3);...
0 FF(2,1) 0 FFF(2,1) 0 0;...
0 FF(2,2) 0 0 FFF(2,2) 0;...
0 FF(2,3) 0 0 0 FFF(2,3);...
0 0 FF(3,1) FFF(3,1) 0 0;...
0 0 FF(3,2) 0 FFF(3,2) 0;...
0 0 FF(3,3) 0 0 FFF(3,3)];

[U,S,V]=svd(M);
t=V(:,6);
for i=1:3
  for j=1:3
    F(i,j)=t(i)*FF(i,j);
  end;
end;

